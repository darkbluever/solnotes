title: "PHP异步MySQL查询尝试"
date: 2016-01-08 09:08:47
categories:
- study
tags:
- php
- mysql
- swoole
- workerman
---

## 背景
最近在做一个数据统计的项目，同一个接口往往需要获取不同类型的指标数据，处理后在同一个结果集中返回。现有方案是通过反范式化的视图表简化数据查询过程来保证接口响应时间的，不过冗余的数据存储增加了数据维护的工作量和复杂度，因为后端需要处理数据一致性、上下游依赖等问题。

然后我们就想是否可以通过异步化的方式提高查询效率，从而降低对数据视图表的依赖。

## 方案
考虑到对已有项目的兼容，下述方案基于PHP+MySQL的技术选型。
1. Model层封装对数据指标的异步查询，通过MySQL异步查询实现。
2. Model层封装对数据指标的同步查询，API层异步调用多个Model层函数，通过RPC接口实现。
3. Model层封装对数据指标的同步查询，API层异步调用多个API层接口，通过REST接口实现。

## demo
基于swoole分别实现方案1和方案2，并进行对比。

## 性能对比

## 总结